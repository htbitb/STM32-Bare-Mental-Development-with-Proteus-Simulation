## What is I2C?
It is just a protocol to achieve serial data communication between integrated circuits(ICs) which are very close to each other. (but more serious protocol than SPI because companies have come forward to design a specification)

I2C protocol details (how data should sent, how data should received, how hand shaking should happen between sender and receiver, error handling) are complex than SPI.. (In other words SPI is simple protocol compared to I2C)


## How different than SPI?
- I2C protocol is multi-master capable, whereas SPI has no guilines to achieve this, but depends on MCU designers. STM SPI peripherals can be used in multi master configurations but arbitration should be handled by software code.

- I2C hardware automatically ACKs every byte received. SPI does not support any automatic ACKing.

- I2C needs just 2 pins for communication whereas SPI may need 4 pins and even more than that it multiple slaves are involved

- I2C master talk to slaves based on slave addresses, whereas in SPI dedicated pin is used to select the slave

- I2C is half duplex, where us SPI is full duplex

- For I2C the max speed is 4MHz in ultra speed plus. for some STM the max speed is just 400KHz. SPI is Fpclk/2.

- In I2C slave can make master wait by holding the clock down if it's busy, thanks to clock stretching feature of I2C. But in SPI, slave has no control over clock, programmers may use their own tricks to overcome this situation

## Data Rate
Data rate (number of bits transferred from sender to receiver in 1 sec) is much lesser in I2C compared to SPI.

For example in STM32F4X if you have peripheral clocks of 40MHz, then in I2C you can achieve data rate of 400Kbps but in SPI it is 20Mbps

So in the above scenario SPI is 50 times faster than I2C


![alt text](picture\image.png)


## SDA and SCL signals

![alt text](picture\image-1.png)

- Both SDA and SCL are bidirectional lines connected to a positive supply voltage via pull-up resistors. when the bus is free, both lines are held at HIGH

- The output stages of devices connected tp the bus must have an open-drain or open-collector configuration

- The bus capacitance limits the number of interfaces connected to the bus.

TIP: Whenever you face problems in I2C, probe  the SDA and SCL line after I2C initialization. It must be held at HIGH (3.3V or 18V depending up on IO voltage level of your boards)

## I2C Protocol Explanation
- Every byte put on the SDA line must be eights bits long
- Each byte must be followed by an Acknowledge Bit
- Data is transferred with the Most Significant Bit (MSB) first
- R/W='1' indicates request for data (READ) 

#### Start and stop conditions 
- All transactions begin with a start (S) and are terminated by a STOP (P)
- A HIGH to LOW transaction on the SDA line while SCL is HIGH defines a START condition.
- A LOW to HIGH transition on the SDA line while SCL is HIGH defines a STOP condition.

![alt text](picture\image-2.png)

- START and STOP conditions are always generated by the master. The bus is considered to be busy after the START condition
- The bus is considered to be free again a certain time after the STOP condition
- When the bus is free another master (if present) can get the chance to claim the bus
- The bus stays busy if a repeated START (Sr) is generated instead of a STOP condition
- Most of the MCU's I2C peripherals support both master and slave mode. you need not to configure the mode because when the peripheral generates the start condition it automatically becomes the master and when it generates the stop condition it goes back to slave mode

#### Adress Phase
**ACK**

The Acknowledge signal is defined as follows:
- the transmitter releases the SDA line during the acknowledge clock pulse so the receiver can pull the SDA line LOW and it remains stable LOW during the HIGH period of this clock.
- The acknowledge takes place after every byte
- The acknowledge bit allows the receiver to signal the transmitter that the byte was successfully received and another byte may be sent
- The master generates all clock pulses, including the acknowledge ninth clock pulse

**Data Validity**

The data on SDA line must be stable during the HIGH period of the clock. The HIGH or LOW state of the data line can only change when the clock signal on the SCL line is LOW. One clock pulse is generated for each data bit transferred.

![alt text](picture\image-3.png)


**I2C Clock Stretching**
- Clock Stretching simply means that holsing the clock to 0 o ground level.
- The moment clock is held at low, then the hold  I2C interface pauses until clock
- I2C devices, either Master or Slave, uses this feature to slow down communication by stretching SCL to low, which prevents the clock to Rise high again and the I2C communication stops for a while
- There are situations where an I2C slave is not able to co-operate with the clock speed given by the master and needs to slow down a little
- if slave needs time, then it takes the advantage of clock stretching, and by holding clock at low, it momentary pauses the I2C operation.

### I2C Transfer sequence

![alt text](picture\image-4.png)